<!DOCTYPE html>
<html>
<head>
    <title>HOO YOU KNOW - Company Lookup</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    
</head>
<body>    
    <div class="container">

        <div class="head">
            <h1>HOO YOU KNOW</h1>
            <p>Choose cities and industries to connect with UVA alumni on LinkedIn and grow your network of Hoos.</p>    
        </div>
        
        <div class="subhead">
            <h3>How to Use</h3>
            <ol>
                <li>Select desired city (one or more)</li>
                <li>Select desired industry (one or more)</li>
                <li>Click Find Companies</li>
                <li>Follow the 'UVA Alumni' link to find relevant alumni to connect with</li>
            </ol>
            <i><b>Note: some links may not have any alumni or return an unavailable page. If you encounter a link that does not work, please contact <a href="mailto:ryanlevy830@gmail.com">ryanlevy830@gmail.com</a></b></i><br>
            <a href="https://forms.gle/bBCW13N1eZAxb4S88" target="_blank">Contribute by adding companies, cities, or industries</a>
        </div>

        <div class="filters">

            <div class="filter1">
                <div class="checkbox-group">
                    <h3>Select Cities:</h3>
                    <div id="cityCheckboxes"></div>
                </div>
            </div>

            <div class="filter2"> 
                <div class="checkbox-group">
                    <h3>Select Industries:</h3>
                    <div id="industryCheckboxes"></div>
                </div>
            </div>

            <div class="button">
                <button onclick="showCompanies()">Find Companies</button>
            </div>

         </div>
        

        <br>

        <div class="table">
            <div id="results"></div>
        </div>

        
        <div class="foot">
            <p>footer</p>
        </div>
    </div>

    <script>
        let cityIndustryData, companyCodesData, locationCodesData, industryBroadData;

        const files = ['../json/city_industry_company.json', '../json/company_codes_.json', '../json/city_code.json', '../json/industry_broad.json']

        fetch(files[0])
            .then(response => response.json())
            .then(data => {
                cityIndustryData = data;
                populateCheckboxes();
            })
            .catch(error => console.error('Error reading the JSON file:', error));

        fetch(files[1])
            .then(response => response.json())
            .then(data => {
                companyCodesData = data;
                populateCheckboxes();
            })
            .catch(error => console.error('Error reading the JSON file:', error));

        fetch(files[2])
            .then(response => response.json())
            .then(data => {
                locationCodesData = data;
                populateCheckboxes();
            })
            .catch(error => console.error('Error reading the JSON file:', error));

        fetch(files[3])
            .then(response => response.json())
            .then(data => {
                industryBroadData = data;
                populateCheckboxes();
            })
            .catch(error => console.error('Error reading the JSON file:', error));

        function populateCheckboxes() {
            if (companyCodesData && cityIndustryData && industryBroadData) {
                const cities = Object.keys(companyCodesData['USA']);
                const industries = [...new Set(Object.values(cityIndustryData['USA']).flatMap(city => Object.keys(city)))];

                const cityCheckboxesDiv = document.getElementById('cityCheckboxes');
                cityCheckboxesDiv.innerHTML = ''; // Clear existing options
                cities.forEach(city => {
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.value = city;
                    checkbox.id = `city-${city}`;

                    const label = document.createElement('label');
                    label.htmlFor = `city-${city}`;
                    label.textContent = city;

                    cityCheckboxesDiv.appendChild(checkbox);
                    cityCheckboxesDiv.appendChild(label);
                    cityCheckboxesDiv.appendChild(document.createElement('br'));
                });

                const industryCheckboxesDiv = document.getElementById('industryCheckboxes');
                industryCheckboxesDiv.innerHTML = ''; // Clear existing options

                // Create columns container
                const columnsContainer = document.createElement('div');
                columnsContainer.className = 'industry-columns';
                
                const leftColumn = document.createElement('div');
                leftColumn.className = 'industry-column';
                const rightColumn = document.createElement('div');
                rightColumn.className = 'industry-column';

                // Define the order of categories for the columns
                const leftColumnCategories = ['STEM & Technical Fields', 'Government, Law & Public Service'];
                const rightColumnCategories = ['Business & Finance', 'Healthcare & Life Sciences', 'Creative & Cultural Industries'];
                const remainingCategories = Object.keys(industryBroadData)
                    .filter(cat => !leftColumnCategories.includes(cat) && !rightColumnCategories.includes(cat));

                // Function to create category div
                const createCategoryDiv = (category) => {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.className = 'industry-category';

                    const header = document.createElement('h3');
                    header.textContent = category;
                    categoryDiv.appendChild(header);

                    // Add checkboxes for industries in this category
                    industryBroadData[category].forEach(industry => {
                        if (industries.includes(industry)) {
                            const wrapper = document.createElement('div');
                            wrapper.className = 'checkbox-wrapper';

                            const checkbox = document.createElement('input');
                            checkbox.type = 'checkbox';
                            checkbox.value = industry;
                            checkbox.id = `industry-${industry}`;

                            const label = document.createElement('label');
                            label.htmlFor = `industry-${industry}`;
                            label.textContent = industry;

                            wrapper.appendChild(checkbox);
                            wrapper.appendChild(label);
                            categoryDiv.appendChild(wrapper);
                        }
                    });

                    return categoryDiv;
                };

                // Populate left column
                leftColumnCategories.forEach(category => {
                    if (industryBroadData[category]) {
                        leftColumn.appendChild(createCategoryDiv(category));
                    }
                });

                // Add first half of remaining categories to left column
                const midpoint = Math.ceil(remainingCategories.length / 2);
                remainingCategories.slice(0, midpoint).forEach(category => {
                    leftColumn.appendChild(createCategoryDiv(category));
                });

                // Populate right column
                rightColumnCategories.forEach(category => {
                    if (industryBroadData[category]) {
                        rightColumn.appendChild(createCategoryDiv(category));
                    }
                });

                // Add second half of remaining categories to right column
                remainingCategories.slice(midpoint).forEach(category => {
                    rightColumn.appendChild(createCategoryDiv(category));
                });

                columnsContainer.appendChild(leftColumn);
                columnsContainer.appendChild(rightColumn);
                industryCheckboxesDiv.appendChild(columnsContainer);
            }
        }
        
        function showCompanies() {
            const selectedCities = Array.from(document.querySelectorAll('#cityCheckboxes input:checked')).map(cb => cb.value);
            const selectedIndustries = Array.from(document.querySelectorAll('#industryCheckboxes input:checked')).map(cb => cb.value);

            // Debugging: Check if the selected city and industry include Washington, D.C. and Government and Public Policy
            console.log("Selected Cities:", selectedCities);
            console.log("Selected Industries:", selectedIndustries);

            if (cityIndustryData && companyCodesData && locationCodesData && selectedCities.length > 0 && selectedIndustries.length > 0) {
                let resultHTML = '<table border="1" style="border-collapse: collapse; width: 50%;">';
                // resultHTML += '<thead><tr><th>Company</th><th>UVA Alumni Link</th></tr></thead>';
                resultHTML += '<tbody>';

                selectedCities.forEach(city => {
                    selectedIndustries.forEach(industry => {
                        // Add a header row for each city/industry combination
                        resultHTML += `<tr><td colspan="2" style="background-color: #cae0fc; height: 10px; font-weight: bold;">${industry}: ${city}</td></tr>`;
                        
                        // Debugging: Check if the data for the city and industry is being accessed correctly
                        console.log(`Fetching data for City: ${city}, Industry: ${industry}`);

                        const companies = cityIndustryData['USA'][city][industry];
                        const companyUrls = companyCodesData['USA'][city][industry];
                        const cityCode = locationCodesData['Cities'][city];

                        // Debugging: Log the data for companies, URLs, and city code to check for issues
                        console.log("Companies:", companies);
                        console.log("Company URLs:", companyUrls);
                        console.log("City Code:", cityCode);

                        companies.forEach((company, index) => {
                            const urlName = companyUrls[index]['Company'];
                            const url = companyUrls[index]['LinkedInURL'];
                            resultHTML += `
                                <tr>
                                    <td><a href="${url}/people/?facetGeoRegion=${cityCode}&facetSchool=4298" target="_blank">${company}</a></td>
                                </tr>`;
                        });

                        // Add a break row after each industry in the current city
                        resultHTML += '<tr><td colspan="2" style="height: 30px;"></td></tr>';
                    });
                });

                resultHTML += '</tbody></table>';

                document.getElementById('results').innerHTML = resultHTML;
            } else {
                alert('Please upload all required JSON files and select at least one city and one industry.');
            }
        }

        
    </script>
</body>
</html>
