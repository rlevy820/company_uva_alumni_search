<!DOCTYPE html>
<html>
<head>
    <title>HOO YOU KNOW - Company Lookup</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
    
</head>
<body>
    <h1>HOO YOU KNOW</h1>
    <p>Choose cities and industries to connect with UVA alumni on LinkedIn and grow your network of Hoos.</p>
    
    <div>
        <h3>How to Use</h3>
        <ol>
            <li>Select one or mulitple cities you are interested in working</li>
            <li>Select one or multiple industries</li>
            <li>Click Find Companies</li>
            <li>Follow the 'UVA Alumni' link to find relevant alumni to connect with</li>
        </ol>
        <i><b>Note: some links may not have any alumni or return an unavailable page. If you encounter a link that does not work, please contact <a href="mailto:ryanlevy830@gmail.com">ryanlevy830@gmail.com</a></b></i>
        <i><b>Contribute: help add new companies, cities, and industries to the website by filling out <a href="https://forms.gle/bBCW13N1eZAxb4S88">this form</a></b></i>
    </div>

    <div class="checkbox-group">
        <h3>Select Cities:</h3>
        <div id="cityCheckboxes"></div>
    </div>

    <div class="checkbox-group">
        <h3>Select Industries:</h3>
        <div id="industryCheckboxes"></div>
    </div>

    <br>

    <button onclick="showCompanies()">Find Companies</button>

    <div id="results"></div>

    <script>
        let cityIndustryData, companyCodesData, locationCodesData;

        const files = ['../json/city_industry_company.json', '../json/company_codes_.json', '../json/city_code.json']

        fetch(files[0])
            .then(response => response.json())
            .then(data => {
                cityIndustryData = data;
                populateCheckboxes();
            })
            .catch(error => console.error('Error reading the JSON file:', error));

        fetch(files[1])
            .then(response => response.json())
            .then(data => {
                companyCodesData = data;
                populateCheckboxes();
            })
            .catch(error => console.error('Error reading the JSON file:', error));

        fetch(files[2])
            .then(response => response.json())
            .then(data => {
                locationCodesData = data;
                populateCheckboxes();
            })
            .catch(error => console.error('Error reading the JSON file:', error));

        function populateCheckboxes() {
            if (companyCodesData && cityIndustryData) {
                const cities = Object.keys(companyCodesData['USA']);
                const industries = [...new Set(Object.values(cityIndustryData['USA']).flatMap(city => Object.keys(city)))]
                    .sort();

                const cityCheckboxesDiv = document.getElementById('cityCheckboxes');
                cityCheckboxesDiv.innerHTML = ''; // Clear existing options
                cities.forEach(city => {
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.value = city;
                    checkbox.id = `city-${city}`;

                    const label = document.createElement('label');
                    label.htmlFor = `city-${city}`;
                    label.textContent = city;

                    cityCheckboxesDiv.appendChild(checkbox);
                    cityCheckboxesDiv.appendChild(label);
                    cityCheckboxesDiv.appendChild(document.createElement('br'));
                });

                const industryCheckboxesDiv = document.getElementById('industryCheckboxes');
                industryCheckboxesDiv.innerHTML = ''; // Clear existing options
                industries.forEach(industry => {
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.value = industry;
                    checkbox.id = `industry-${industry}`;

                    const label = document.createElement('label');
                    label.htmlFor = `industry-${industry}`;
                    label.textContent = industry;

                    industryCheckboxesDiv.appendChild(checkbox);
                    industryCheckboxesDiv.appendChild(label);
                    industryCheckboxesDiv.appendChild(document.createElement('br'));
                });
            }
        }
        
        function showCompanies() {
            const selectedCities = Array.from(document.querySelectorAll('#cityCheckboxes input:checked')).map(cb => cb.value);
            const selectedIndustries = Array.from(document.querySelectorAll('#industryCheckboxes input:checked')).map(cb => cb.value);

            // Debugging: Check if the selected city and industry include Washington, D.C. and Government and Public Policy
            console.log("Selected Cities:", selectedCities);
            console.log("Selected Industries:", selectedIndustries);

            if (cityIndustryData && companyCodesData && locationCodesData && selectedCities.length > 0 && selectedIndustries.length > 0) {
                let resultHTML = '<table border="1" style="border-collapse: collapse; width: 100%;">';
                // resultHTML += '<thead><tr><th>Company</th><th>UVA Alumni Link</th></tr></thead>';
                resultHTML += '<tbody>';

                selectedCities.forEach(city => {
                    selectedIndustries.forEach(industry => {
                        // Add a header row for each city/industry combination
                        resultHTML += `<tr><td colspan="2" style="background-color: #cae0fc; height: 10px; font-weight: bold;">${industry}: ${city}</td></tr>`;
                        
                        // Debugging: Check if the data for the city and industry is being accessed correctly
                        console.log(`Fetching data for City: ${city}, Industry: ${industry}`);

                        const companies = cityIndustryData['USA'][city][industry];
                        const companyUrls = companyCodesData['USA'][city][industry];
                        const cityCode = locationCodesData['Cities'][city];

                        // Debugging: Log the data for companies, URLs, and city code to check for issues
                        console.log("Companies:", companies);
                        console.log("Company URLs:", companyUrls);
                        console.log("City Code:", cityCode);

                        companies.forEach((company, index) => {
                            const urlName = companyUrls[index]['Company'];
                            const url = companyUrls[index]['LinkedInURL'];
                            resultHTML += `
                                <tr>
                                    <td><a href="${url}/people/?facetGeoRegion=${cityCode}&facetSchool=4298" target="_blank">${company}</a></td>
                                </tr>`;
                        });

                        // Add a break row after each industry in the current city
                        resultHTML += '<tr><td colspan="2" style="height: 30px;"></td></tr>';
                    });
                });

                resultHTML += '</tbody></table>';

                document.getElementById('results').innerHTML = resultHTML;
            } else {
                alert('Please upload all required JSON files and select at least one city and one industry.');
            }
        }

        
    </script>
</body>
</html>
